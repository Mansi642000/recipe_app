{% extends "base.html" %}
{% block content %}
  <h2>{{ recipe.title }}</h2>
  <p><strong>Ingredients:</strong><br>{{ recipe.ingredients }}</p>
  <p><strong>Instructions:</strong><br>{{ recipe.instructions }}</p>
  
  <h3>Nutritional Summary</h3>
  <ul>
    <li>Calories: {{ recipe.calories or 0 }} kcal</li>
    <li>Proteins: {{ recipe.proteins or 0 }} g</li>
    <li>Fats: {{ recipe.fats or 0 }} g</li>
    <li>Carbs: {{ recipe.carbs or 0 }} g</li>
    <li>Fibers: {{ recipe.fibers or 0 }} g</li>
  </ul>

  {% if recipe.user_id == current_user.id %}
    <a href="{{ url_for('edit_recipe', recipe_id=recipe.id) }}">Edit</a>
    <form action="{{ url_for('delete_recipe', recipe_id=recipe.id) }}" method="POST" style="display:inline;">
      <button type="submit">Delete</button>
    </form>
  {% endif %}

  <h3>Ratings:</h3>
  {% for r in recipe.ratings %}
    <p>{{ r.user.username }}: {{ r.score }}/5</p>
  {% else %}
    <p>No ratings yet.</p>
  {% endfor %}

  <h3>Comments:</h3>
  {% for c in recipe.comments %}
    <p><strong>{{ c.user.username }}:</strong> {{ c.content }}</p>
  {% else %}
    <p>No comments yet.</p>
  {% endfor %}

  <h4>Rate this recipe</h4>
  <form method="post" action="{{ url_for('rate_recipe', recipe_id=recipe.id) }}">
    {{ rating_form.hidden_tag() }}
    {{ rating_form.score.label }} {{ rating_form.score() }}
    {{ rating_form.submit() }}
  </form>

  <h4>Add a comment</h4>
  <form method="post" action="{{ url_for('comment_recipe', recipe_id=recipe.id) }}">
    {{ comment_form.hidden_tag() }}
    {{ comment_form.content.label }} {{ comment_form.content() }}
    {{ comment_form.submit() }}
  </form>

  <form method="post" action="{{ url_for('favorite_recipe', recipe_id=recipe.id) }}">
    {% if is_favorite %}
      <button type="submit">Remove from Favorites</button>
    {% else %}
      <button type="submit">Add to Favorites</button>
    {% endif %}
  </form>

  {% if recipe.image_url %}
  <img src="{{ recipe.image_url }}" alt="{{ recipe.title }}" style="max-width: 400px;">
{% endif %}

{% if recipe.youtube_url %}
  <p>
    <a href="{{ recipe.youtube_url }}" target="_blank">Watch Video</a>
  </p>
{% endif %}

{% endblock %}
